<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head th:include="fragments/header :: head (~{::title})">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description"
	content="A fully featured admin theme which can be used to build CRM, CMS, etc.">
<meta name="author" content="Coderthemes">

<link rel="shortcut icon" href="images/favicon_1.ico">

<title>NIB Funeral Collection:: Reset Password</title>

<!-- Base Css Files -->
<link th:href="@{css/bootstrap.min.css}" rel="stylesheet" />

<!-- Font Icons -->
<link th:href="@{assets/font-awesome/css/font-awesome.min.css}"
	rel="stylesheet" />
<link th:href="@{assets/ionicon/css/ionicons.min.css}" rel="stylesheet" />
<link th:href="@{css/material-design-iconic-font.min.css}" rel="stylesheet">

<!-- animate css -->
<link th:href="@{css/animate.css}" rel="stylesheet" />

<!-- Waves-effect -->
<link th:href="@{css/waves-effect.css}" rel="stylesheet">

<!-- Custom Files -->
<link th:href="@{css/helper.css}" rel="stylesheet" type="text/css" />
<link th:href="@{css/style.css}" rel="stylesheet" type="text/css" />

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js}"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js}"></script>
        <![endif]-->

<!-- <script src="js/modernizr.min.js}"></script>
 -->
 
<!--  <script th:src="@{/resources/pwstrength.js}"></script>
 --> 
</head>
<body>


	<div class="wrapper-page">
		<div class="panel panel-color panel-primary panel-pages">
		
			<div class="panel-heading bg-img">
				<div class="bg-overlay"></div>
				<h3 class="text-center m-t-10 text-white">
					Change Password to <strong>NIB Funeral Collection</strong>
				</h3>
			</div>



			<div class="panel-body">
				<form 
					class="form-signin form-horizontal m-t-20"
					  id="signupForm" role="form" th:object="${credentials}"  novalidate="novalidate" >
					  
					 <div style="display:none" class="alert alert-info alert-dismissable">
                        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                        Enter your <b>Email</b> and instructions will be sent to you!
                    </div>
                    
                     <div id="updSuc" style="display:none" class="alert alert-info alert-dismissable">
                        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                        Update Successful Click Login <b></b>
                    </div>
                    
                      <div id="updFail" style="display:none" class="alert alert-danger alert-dismissable">
                        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                        Update Failed Try again <b></b>
                    </div>
                    
                     <div id="passNotMatch" style="display:none" class="alert alert-danger alert-dismissable">
                        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                        Password Does Not Match <b></b>
                    </div>
                    
                    
					  
<!-- 					  <label th:text="#{message}" ></label>
 -->
					<!--  <div class="form-group ">
                        <div class="col-xs-12">
                            <input class="form-control input-lg " type="text" required="" id="email" name="email"  th:placeholder="Email" >
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-xs-12">
                            <input class="form-control input-lg" type="password" required="" th:placeholder="Password"
				id="password" name="password"  >
                        </div>
                    </div> -->

					<!-- <p style="color: red" class="error-message"
						th:if="${#fields.hasGlobalErrors()}"
						th:each="error : ${#fields.errors('global')}" th:text="${error}">Validation
						error</p> -->

				<!-- 	<div th:if="${param.logout}">
						<div class="alert alert-info">You have been logged out.</div>
					</div> -->
					<!-- <div class="form-group"
						th:classappend="${#fields.hasErrors('email')}? 'has-error':''">
						                    <label for="email">EMAI</label>:

						<div class="col-xs-12">
							<input type="text" class="form-control input-lg" id="email"
								name="email" th:field="*{email}" autofocus="autofocus"
								placeholder="E-mail" />
						</div>
					</div> -->
<!-- 					<label th:text="${message}"></label>

 -->		
 
 					 <div hidden class="form-group">
                         <label for="inputId">Id</label>
                         
                         <input type="text" value="john" th:field="*{email}" id="inputId" class="form-control">
                         
                         <!-- <input type="text" value="john" th:value="${session.id}" id="inputId" class="form-control"> -->
                         
                     </div> 
                                            
                                            
 					<div class="form-group" >
<!-- 						th:classappend="${#fields.hasErrors('password')}? 'has-error':''">
 -->						<!--                     <label for="password">Password</label>:
 -->

						<div class="col-xs-12">

							<input type="password" id="oldPassword" class="form-control input-lg" required name="oldPassword" placeholder="OldPassword" />
<!-- 								class="form-control input-lg" th:field="*{password}"
 -->								
						</div>
					</div>
 
 
 					<div class="form-group" >
<!-- 						th:classappend="${#fields.hasErrors('password')}? 'has-error':''">
 -->						<!--                     <label for="password">Password</label>:
 -->

						<div class="col-xs-12">

							<input type="password" id="newPassword" class="form-control input-lg" required name="newPassword" placeholder="NewPassword" />
<!-- 								class="form-control input-lg" th:field="*{password}"
 -->								
						</div>
					</div>
					
					<div class="form-group" >
<!-- 						th:classappend="${#fields.hasErrors('password')}? 'has-error':''">
 -->						<!--                     <label for="password">Password</label>:
 -->

						<div class="col-xs-12">

							<input type="password" id="confirmPassword" class="form-control input-lg" required name="password" placeholder="Confirm Password" />
							<!-- 	class="form-control input-lg" th:field="*{password}"
								placeholder="CPassword" /> -->
						</div>
					</div>


		<!-- 			<div class="form-group">
						<div class="col-xs-12">

							<label for="role">Log in as</label> <select id="role"
								class="form-control input-lg " th:field="*{role}">
								<option selected="selected" value="ROLE_NORMALUSER">NORMALUSER</option>
								<option value="ROLE_SUPERUSER">SUPERUSER</option>
								<option value="ROLE_ADMIN">ADMIN</option>
							</select>
						</div>
					</div> -->

					<!-- <div class="form-group ">
                        <div class="col-xs-12">
                            <div class="checkbox checkbox-primary">
                                <input id="checkbox-signup" type="checkbox">
                                <label for="checkbox-signup">
                                    Remember me
                                </label>
                            </div>
                            
                        </div>
                    </div> -->
					<div class="form-group text-center m-t-40">
						<div class="col-xs-12">
							<button onclick="updateUserPassword()" class="btn btn-lg btn-primary btn-block" name="Submit"
								value="Login" type="Submit" th:text="Change">Log In</button>
							<!-- <button class="btn btn-primary btn-lg w-lg waves-effect waves-light" type="submit">Log In</button> -->
						</div>
					</div>
					
						<div class="form-group text-center m-t-10">
						<div class="col-xs-12">
					                            <a  th:href="@{/login( __(${aid} != null) ? 'aid = ${aid}' : ','__ )}">Login</a>
					</div>
					</div>

					<!-- <div class="form-group m-t-30">
                        <div class="col-sm-7">
                            <a th:href="@{/recoverpw}" ><i class="fa fa-lock m-r-5"></i> Forgot your password?</a>
                        </div>
                        <div class="col-sm-5 text-right">
                            <a  th:href="@{/registration}">Create an account</a>
                        </div>
                    </div> -->
				</form>
			</div>

		</div>
	</div>


	<script>
		var resizefunc = [];
	</script>
	 <script th:src="@{js/jquery.min.js}"></script>
        <script th:src="@{js/bootstrap.min.js}"></script>
        <script th:src="@{js/waves.js}"></script>
        <script th:src="@{js/wow.min.js}"></script>
        <script th:src="@{js/jquery.nicescroll.js}" type="text/javascript"></script>
        <script th:src="@{js/jquery.scrollTo.min.js}"></script>
        <script th:src="@{assets/jquery-detectmobile/detect.js}"></script>
        <script th:src="@{assets/fastclick/fastclick.js}"></script>
        <script th:src="@{assets/jquery-slimscroll/jquery.slimscroll.js}"></script>
        <script th:src="@{assets/jquery-blockui/jquery.blockUI.js}"></script> 


	<!-- CUSTOM JS -->
	<script th:src="@{js/jquery.app.js}"></script>
	
	<script th:inline="javascript">
/* var serverContext = [[@{/}]];

		$(document).ready(function () {
			
			
		    $('form').submit(function(event) {
		    	savePass(event);
		    });
    

    

}); */

/* function savePass(event){
    $(".alert").html("").hide();
    $(".error-list").html("");
    if($("#password").val() != $("#matchPassword").val()){
        $("#globalError").show().html( */
        /* return;
    }
    var formData= $('form').serialize();
    $.post(serverContext + "/registration/user/updatePassword",formData ,function(data){
    	window.location.href = serverContext + "console.html" + "?message="+data.message;
    })
    .fail(function(data) {
        if(data.responseJSON.error.indexOf("InvalidOldPassword") > -1) {
            $("#errormsg").show().append(data.responseJSON.message);
        }
        else if(data.responseJSON.error.indexOf("InternalError") > -1){
            $("#errormsg").show().append(data.responseJSON.message);
        }
        else{
        	var errors = $.parseJSON(data.responseJSON.message);
            $.each( errors, function( index,item ){
                $("#globalError").show().html(item.defaultMessage);
            });
            errors = $.parseJSON(data.responseJSON.error);
            $.each( errors, function( index,item ){
                $("#globalError").show().append(item.defaultMessage+"<br/>");
            });
        }
    });
}
 */
 
 var getUrlParameter = function getUrlParameter(sParam) {
	    var sPageURL = window.location.search.substring(1),
	        sURLVariables = sPageURL.split('&'),
	        sParameterName,
	        i;

	    for (i = 0; i < sURLVariables.length; i++) {
	        sParameterName = sURLVariables[i].split('=');

	        if (sParameterName[0] === sParam) {
	            return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
	        }
	    }
	};


</script>


  <script type="text/javascript">
        
        function updateUserPassword(e){
        
        	

			 $("#loading").show();
	       	 
		       	
			 var id = $.trim($("#inputId").val());
	       	

	       	 var password=$("#oldPassword").val();
	       	 
	       	 var newPassword=$("#newPassword").val();

	       	 var confirmPassword=$("#confirmPassword").val();
	       

	            
	            var PasswordDto = {};
	            
	          
	            PasswordDto["password"] = password;
	            PasswordDto["newpassword"] = newPassword;
	          	            
	            PasswordDto["id"] = id;
	            
	 if(newPassword==confirmPassword){
		 
		if(password!="" && newPassword!="" && id!=""){
	                           
            var updateData = $.ajax({
                type: "POST",
                url: "[[@{/api/user/updatePassword}]]",
                data: JSON.stringify(PasswordDto),
                contentType : 'application/json',
                success: function(data){
                	
                	var obj = JSON.parse(data);
                	
                	var tp; 

             		$("#passNotMatch").hide();

                	if(obj.result_code=="00"){
                		
                         //tp="success";  
                		$("#updSuc").show();
                		$("#updFail").hide();

                    }else{
                		$("#updFail").show();

                		$("#updSuc").hide();

                       // tp="warning";  

                    }
            		 
                	//alert(data);
            		/*  swal({   
                         title: "Alert!",   
                         text: obj.result_message,   
                         type: tp,   
                         showCancelButton: false,   
                         confirmButtonText: "Ok",   
                         closeOnConfirm: true 
                     }, function(){ 
                    	 
                    	 if(obj.result_code=="00"){
                    		 
                        	 location.reload();

                         }
 		   				
                     }); */

                  //	$("#loading").hide();

                }
            });


            }
	 }else{
		 
		/*  swal({   
             title: "Alert!",   
             text: "Sorry Passwords dont Match",   
             type: "warning",   
             showCancelButton: false,   
             confirmButtonText: "Ok",   
             closeOnConfirm: true 
         }, function(){ 
        	 
        	
         }); */
         
 		$("#passNotMatch").show();

         
	 }
            }
          
        
        
        </script>
          <!-- CUSTOM JS -->
        <script th:src="@{js/jquery.app.js}"></script>

        <!--form validation-->
        <script type="text/javascript" th:src="@{assets/jquery.validate/jquery.validate.min.js}"></script>

        <!--form validation init-->
        <script th:src="@{assets/jquery.validate/form-validation-init.js}"></script>
</body>
</html>