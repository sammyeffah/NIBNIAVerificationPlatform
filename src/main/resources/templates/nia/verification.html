<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head th:insert="~{fragments/header :: head (~{::title})}">

    <head>
        <meta charset="utf-8">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description">
        <meta content="Coderthemes" name="author">
        <meta content="${_csrf.token}" name="_csrf">
        <meta content="${_csrf.headerName}" name="_csrf_header">

        <title>NIB NIA :: Verification Data</title>

        <!-- Custom Files -->
        <link rel="stylesheet" th:href="@{/static/css/helper.css}" type="text/css" />
        <link rel="stylesheet" th:href="@{/static/css/style.css}" type="text/css" />
        <!-- Font Icons -->
        <link rel="stylesheet"
            th:href="@{https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/fontawesome.min.css}" />
        <link rel="stylesheet" th:href="@{https://cdn.datatables.net/buttons/2.2.3/css/buttons.dataTables.min.css}">
        <link href="@{https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css}" rel="stylesheet">
        <link rel="stylesheet"
            th:href="@{https://cdnjs.cloudflare.com/ajax/libs/ionicons/4.5.6/css/ionicons.min.css}" />

        <style>
            @media screen {
                .print-only {
                    display: none;
                }
            }

            @media print {
                .print-only {
                    display: block;
                }
            }
        </style>

    </head>


<body class="fixed-left">

    <!-- Begin page -->
    <div class="container" id="wrapper" style="padding-top: 1.1%;">

        <div th:insert="~{fragments/header :: banner}"></div>

        <!-- ========== Left Sidebar Start ========== -->
        <!-- <div th:insert="~{fragments/sidebar :: sidebar(create_scheme_key)}"></div> -->
        <!-- ========== Left Sidebar Start ========== -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="content-page">
            <!-- Start content -->
            <div class="content">
                <div class="container">
                    <input id="loggedInUser" th:value="${username}" type="hidden">
                    <!-- Page-Title -->
                    <div class="row">

                        <div class="col-md-4"></div>

                        <div class="col-md-8">

                            <!-- <h4 class="pull-left page-title">Tasks</h4> -->
                            <div class="pull-left page-title">
                                <button class="btn btn-primary btn-lg waves-effect waves-light "
                                    data-bs-target="#spool-data-modal" data-bs-toggle="modal">
                                    NIA Verification Data<i class="fa fa-plus"></i>
                                </button>
                            </div>

                        </div>

                        <div aria-hidden="true" aria-labelledby="myModalLabel" class="modal fade" id="spool-data-modal"
                            role="dialog" style="display: none;" tabindex="-1">
                            <div class="modal-dialog" style="width: 30%;">
                                <div class="modal-content">

                                    <form action="#" id="verify-data-form" method="" novalidate>

                                        <div class="modal-header">
                                            <button aria-hidden="true" class="close" data-bs-dismiss="modal"
                                                type="button">Ã—
                                            </button>
                                            <h4 class="modal-title">Verify with Short Guid</h4>
                                        </div>
                                        <div class="modal-body">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="mb-3">
                                                        <label class="control-label" for="shortGuid">Short Guid</label>
                                                        <input class="form-control" id="shortGuid" name="shortGuid"
                                                            type="text">
                                                    </div>
                                                </div>

                                            </div>

                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="mb-3">
                                                        <label for="reason" class="control-label">Reason
                                                        </label> <select class="form-select" id="reason" name="reason">
                                                            <option value="Remmittance">Remmittance</option>
                                                            <option value="Payment">Payment</option>
                                                            <option value="Account_Opening">Account Opening</option>
                                                            <option value="Withdrawal">Withdrawal</option>
                                                            <option value="Deposit">Deposit</option>
                                                            <option value="Others">Others</option>
                                                            <option value="Test">Test</option>
                                                        </select>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>


                                        <div class="modal-footer">
                                            <!-- <button type="button" class="btn btn-info waves-effect waves-light"
                                            id="add-textbox-btn">Include
                                            Items</button> -->

                                            <button class="btn btn-primary " id="btnCollectionAdd"
                                                onclick="fetchVerificationDataByShortGuid(this)" type="submit">Spool
                                                Data
                                            </button>
                                            <button class="btn btn-primary waves-effect waves-light"
                                                data-bs-dismiss="modal" type="button">Close
                                            </button>
                                        </div>

                                    </form>
                                </div>
                            </div>

                        </div>
                        <!-- Modal End-->

                        <!-- Another Modal for display -->
                        <!-- Modal structure already in the HTML -->
                        <div aria-hidden="true" aria-labelledby="verifyModalCenterTitle" class="modal fade"
                            id="display-verify-details" role="dialog" tabindex="-1">
                            <div class="modal-dialog modal-dialog-centered" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h4 class="modal-title" id="verifyModalTitle">Verified Details</h4>
                                    </div>
                                    <div class="modal-body" id="modal-body-content">
                                        <!-- Dynamic content will go here -->
                                    </div>
                                    <div class="modal-footer">
                                        <button class="btn btn-secondary" data-bs-dismiss="modal"
                                            type="button">OK</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div id="loading" style="display: none"></div>

                    <ol class="breadcrumb">

                        <!-- <div sec:authorize="hasRole('ADMIN')">
                        <li><a href="#">NIB Collection</a>|</li>
                        <li><a th:href="@{admin}">Users</a>|</li>
                        <li><a th:href="@{details}">Details</a>|</li>
                        <li class="active">Collection</li>
                    </div> -->

                        <!-- <div sec:authorize="hasRole('ADMIN')"> -->
                        <li><a href="#">NIA Data</a>/</li>
                        <li class="active">Verification</li>
                        <!-- </div> -->


                    </ol>
                </div>
            </div>

        </div>

        <div class="row">
            <div class="col-md-12">

                <div class="card card-default">
                    <div class="card-header">
                        <h3 class="card-title">NIA Verification Data</h3>
                    </div>
                    <div class="card-body">

                        <div class="row">
                            <div class="col-md-12">

                                <div id="loading-spinner" style="text-align: center; display: none;">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                                <table class="display" id="datatable" style="width: 100%">
                                    <thead>
                                        <tr>

                                            <th>Id</th>
                                            <th>Nation Id</th>
                                            <th>Request Status</th>
                                            <th>Transaction Id</th>
                                            <th>Request Time</th>
                                            <th>Response Time</th>
                                            <th>Name</th>
                                            <th>Phone Number</th>
                                            <th>Destination Address</th>
                                            <th>Other Address</th>
                                            <th>Date of Birth</th>
                                            <th>Reason</th>


                                        </tr>
                                    </thead>


                                    <tbody>
                                        <tr>

                                        </tr>
                                    </tbody>
                                </table>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <!-- End Row -->


    </div>

    <div th:insert="~{fragments/footer :: footer}"></div>
    </div>
    <!-- content -->

    <script>
        var resizefunc = [];
    </script>
    <script th:src="@{https://code.jquery.com/jquery-3.5.1.js}"></script>
    <script th:src="@{https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js}"></script>
    <script th:src="@{https://cdn.datatables.net/buttons/2.2.3/js/dataTables.buttons.min.js}"></script>
    <script th:src="@{https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js}"></script>
    <script th:src="@{https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js}"></script>
    <script th:src="@{https://cdn.datatables.net/buttons/2.2.3/js/buttons.html5.min.js}"></script>
    <script th:src="@{https://cdn.datatables.net/buttons/2.2.3/js/buttons.print.min.js}"></script>
    <script crossorigin="anonymous" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
        th:src="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js}"></script>
    <script crossorigin="anonymous" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script th:src="@{https://cdnjs.cloudflare.com/ajax/libs/node-waves/0.5.1/waves.min.js}"></script>
    <script th:src="@{https://cdnjs.cloudflare.com/ajax/libs/wow/1.1.2/wow.min.js}"></script>
    <script th:src="@{https://cdnjs.cloudflare.com/ajax/libs/jquery.nicescroll/3.7.6/jquery.nicescroll.js}"
        type="text/javascript"></script>
    <script th:src="@{https://cdnjs.cloudflare.com/ajax/libs/Detect.js/2.2.2/detect.js}"></script>
    <script th:src="@{https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js}"></script>
    <script th:src="@{https://cdnjs.cloudflare.com/ajax/libs/jQuery-slimScroll/1.3.8/jquery.slimscroll.js}"></script>
    <script th:src="@{https://cdnjs.cloudflare.com/ajax/libs/jquery.blockUI/2.70/jquery.blockUI.js}"></script>
    <script th:src="@{https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js}"></script>
    <script th:src="@{https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js}"></script>
    <script th:src="@{https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js}"></script>

    <script>

        $('#loading-spinner').show();
        getVerificationDataList();

        function getVerificationDataList() {


            $
                .ajax({

                    'url': "[[@{/nib/api/nia/verify-data/all}]]",
                    'method': "GET",

                    'contentType': 'application/json'
                })
                .done(function (data) {
                    $('#loading-spinner').hide();

                    $('#datatable')
                        .dataTable({
                            "scrollX": true,
                            "processing": true,
                            "destroy": true,
                            pageLength: 50,
                            "aaData": data,
                            "dom": 'lBfrtip',
                            buttons: [
                                {
                                    extend: 'excelHtml5',
                                    text: 'Excel',
                                    title: 'T24 Funds Transfer Report'

                                },
                                {
                                    extend: 'pdfHtml5',
                                    text: 'PDF',
                                    title: 'T24 Funds Transfer Report'
                                },
                                {
                                    extend: 'csv',
                                    text: 'CSV',
                                    title: 'T24 Funds Transfer Report'

                                },

                                'copy',

                                {
                                    extend: 'print',
                                    text: 'Print',
                                    title: 'T24 Funds Transfer Report'
                                }
                            ],

                            order: [4, "desc"],

                            "columns": [

                                {
                                    "data": "id"
                                },

                                {
                                    "data": "nationalId"
                                },

                                {
                                    "data": "requestStatus"
                                },

                                {
                                    "data": "transactionId"
                                },

                                {
                                    "data": "requestTime"
                                },

                                {
                                    "data": "responseTime"
                                },

                                {
                                    "data": "name"
                                },
                                {
                                    "data": "phoneNumber"
                                },

                                {
                                    "data": "digitalAddress"
                                },

                                {
                                    "data": "otherDigitalAddress"
                                },
                                {
                                    "data": "dateOfBirth"
                                },
                                {
                                    "data": "reason",
                                    render: function (data) {
                                        return data ? data : ""; // Handle null or undefined values
                                    }
                                }

                            ]

                        });

                }).fail(function (jqXHR, textStatus, errorThrown) {
                    console.error("Error fetching data: ", textStatus, errorThrown);
                });

        }

        function formatDate(dateArray) {
            // Create a date object from the array
            var date = new Date(Date.UTC(dateArray[0], dateArray[1] - 1, dateArray[2], dateArray[3], dateArray[4], dateArray[5]));
            var year = date.getFullYear();
            var month = String(date.getMonth() + 1).padStart(2, '0'); // Add leading zero
            var day = String(date.getDate()).padStart(2, '0'); // Add leading zero
            var hours = String(date.getHours()).padStart(2, '0'); // Add leading zero
            var minutes = String(date.getMinutes()).padStart(2, '0'); // Add leading zero
            var seconds = String(date.getSeconds()).padStart(2, '0'); // Add leading zero

            // Return formatted date
            return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        }
    </script>

    <script>
        // Attach the submit event to the form
        document.getElementById('verify-data-form').addEventListener('submit', function (e) {
            e.preventDefault(); // Prevent traditional form submission
            fetchVerificationDataByShortGuid(e); // Call your AJAX function
        });

        function fetchVerificationDataByShortGuid(e) {
            var shortGuid = $("#shortGuid").val();
            var reason = $('#reason').val();

            $.ajax({
                url: "/nib/api/nia/verify-data?shortGuid=" + shortGuid + "&reason=" + reason, // Adjust your URL
                method: "GET",
                contentType: 'application/json'
            }).done(function (data) {
                console.log("DATA RECEIVED:: " + data);
                $('#spool-data-modal').modal('hide');

                if (data && data !== "") {
                    const jsonObject = JSON.parse(data);
                    var modalContent = `
                    <h6>Personal ID Number: ${jsonObject.nationalId}</h6>
                    <h6>Name: ${jsonObject.name}</h6>
                    <h6>Date of Birth: ${jsonObject.dateOfBirth}</h6>
                    <h6>Gender: ${jsonObject.gender}</h6>
                    <h6>Document Number: ${jsonObject.cardId}</h6>
                    <h6>Issue Date: ${jsonObject.cardValidFrom}</h6>
                    <h6>Expiry Date: ${jsonObject.cardValidTo}</h6>
                    <h6>Transaction ID: ${jsonObject.transactionId}</h6>
                    <h6>Request Time: ${jsonObject.requestTime}</h6>
                    <h6>Response Time: ${jsonObject.responseTime}</h6>
                    <h6>Digital Address: ${jsonObject.digitalAddress ? jsonObject.digitalAddress : jsonObject.otherDigitalAddress}</h6>
                `;
                    $('#modal-body-content').html(modalContent);
                    $('#display-verify-details').modal('show');
                } else {

                    swal("Data not found for " + shortGuid, "Error");
                }

                $('#display-verify-details').on('hidden.bs.modal', function () {
                    location.reload();
                });

            })
                .fail(function (jqXHR, textStatus, errorThrown) {
                    console.error("Error occurred: " + textStatus, errorThrown);
                    swal("An error occurred while fetching data", "Error");
                });
        }
    </script>

    <script th:src="@{https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.20.0/jquery.validate.min.js}"
        type="text/javascript"></script>

    <script
        th:src="@{https://cdnjs.cloudflare.com/ajax/libs/formvalidation/0.6.2-dev/js/formValidation.min.js}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


</body>

</html>